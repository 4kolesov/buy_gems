# RESTful API для обработки и анализа данных сделок

Данный проект представляет собой RESTful API на базе Django для обработки и анализа данных о сделках, представленных в формате .csv файлов. API предоставляет возможность загрузить файл с данными о сделках, произвести их обработку, сохранить результаты в базе данных и получить аналитическую информацию о клиентах.

1. [Установка зависимостей](#1-установка-зависимостей)
2. [Клонирование репозитория](#2-клонирование-репозитория)
3. [Запуск контейнера](#3-запуск-контейнера)
4. [Применение миграций](#4-применение-миграций)
5. [Использование API](#использование-api)
   - [Выдача обработанных данных](#выдача-обработанных-данных)
   - [Загрузка файла для обработки](#загрузка-файла-для-обработки)
6. [Завершение работы](#завершение-работы)


___

### 1. Установка зависимостей
Для начала установите Docker и Docker Compose, если они еще не установлены на вашей системе.

### 2. Клонирование репозитория
Склонируйте данный репозиторий на вашу локальную машину:

```
git clone git@github.com:4kolesov/buy_gems.git
```

### 3. Запуск контейнера
Перейдите в папку с файлом `docker-compose.yaml` командой:
```
cd buy_gems
```
Удостоверьтесь, что `docker-compose.yaml` находится в текущей директории:
```
ls -a
```
Используя Docker Compose, запустите контейнер с помощью следующей команды:

```
docker-compose up -d
```

Эта команда создаст и запустит контейнер для веб-сервиса.

### 4. Применение миграций
Миграции и сбор статики будут созданы автоматически.


### 5. Использование API
После успешного запуска контейнера, вы можете использовать следующие эндпоинты для взаимодействия с API:

#### Выдача обработанных данных

URL: `http://127.0.0.1:8000/api/v1/top_clients/`

Метод: GET

В ответе содержится поле "response" со списком из 5 клиентов, потративших наибольшую сумму за весь период. Каждый клиент описывается следующими полями:

- `username` - логин клиента;
- `spent_money` - сумма потраченных средств за весь период;
- `gems` - список из названий камней, которые купили как минимум двое из списка "5 клиентов, потративших наибольшую сумму за весь период", и данный клиент является одним из этих покупателей.

#### Загрузка файла для обработки

URL: `http://localhost:8000/api/v1/upload/`

Метод: POST

Аргументы:

- `deals` - файл, содержащий историю сделок (в формате .csv), является исходным файлом данных, который используется для обработки веб-сервисом. Файл должен быть в формате CSV (Comma-Separated Values) и содержать следующие поля:
1. `date` (обязательное поле) - дата и время совершения сделки в формате 'ГГГГ-ММ-ДД ЧЧ:ММ:СС.МС' (например, '2023-01-15 10:30:00.000').
2. `customer` (обязательное поле) - имя покупателя, осуществившего сделку.
3. `item` (обязательное поле) - название товара/предмета, который был приобретен.
4. `quantity` (обязательное поле) - количество приобретенных товаров/предметов.
5. `price` (обязательное поле) - стоимость одного единицы товара/предмета (в валюте сделки).

Пример строки в файле CSV:

```
date,customer,item,quantity,price
2023-01-15 10:30:00.000,John Doe,Apple,2,0.5
```


Ответ:

- Если файл был обработан без ошибок:
  ```
  {
    "status": "OK"
  }
  ```

- Если в процессе обработки файла произошла ошибка:
  ```
  {
    "status": "error"
    "Desc": "Описание ошибки",
  }
  ```

## Завершение работы

Для остановки контейнера выполните следующую команду:

```
docker-compose down
```
